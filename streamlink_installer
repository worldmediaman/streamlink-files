#!/bin/sh
echo ""
if [ -f /etc/apt/apt.conf ] ; then
    echo 'Streamlink DREAMBOX OE2.5/2.6 IMAGES için uygun değildir....'
elif [ -f /etc/opkg/opkg.conf ] ; then
    opkg update > /dev/null 2>&1;
    echo ':DREAMBOX OE2.0 IMAGES'
    if ! opkg list-installed | egrep ^enigma2-plugin-systemplugins-serviceapp >/dev/null ; then
        opkg install --force-reinstall enigma2-plugin-systemplugins-serviceapp > /dev/null 2>&1
    fi
    # Cihazın feed kaynaklarından dosyaları indirme
    for package in streamlinksrv python-streamlink python-iso3166 python-iso639 python-isodate python-singledispatch python-websocket-client python-futures python-singledispatch; do
        if ! opkg list-installed | egrep ^${package} >/dev/null ; then
            echo -e "${package} found on open-images Update Feed\ninstall ${package}"
            opkg install --force-reinstall ${package} > /dev/null 2>&1
        fi
    done
    # ilgili depodan dosyaları indirme
    URL="https://github.com/worldmediaman/streamlink-files/raw/main/Files"
    if ! opkg list-installed | egrep ^streamlinksrv >/dev/null ; then
        opkg install --force-reinstall "${URL}/streamlinksrv_1.5.0_all.ipk" > /dev/null 2>&1
    fi
    if ! opkg list-installed | egrep ^python-streamlink >/dev/null ; then
        opkg install --force-reinstall "${URL}/python-streamlink_1.27.1.0.r0_mod_all.ipk" > /dev/null 2>&1
    fi
    if ! opkg list-installed | egrep ^python-iso3166 >/dev/null ; then
        opkg install --force-reinstall "${URL}/python-iso3166_0.9_all.ipk " > /dev/null 2>&1
    fi
    if ! opkg list-installed | egrep ^python-iso639 >/dev/null ; then
        opkg install --force-reinstall "${URL}/python-iso639_0.4.5_all.ipk" > /dev/null 2>&1
    fi
    if ! opkg list-installed | egrep ^python-isodate >/dev/null ; then
        opkg install --force-reinstall "${URL}/python-isodate_0.6.0_all.ipk" > /dev/null 2>&1
    fi
    if ! opkg list-installed | egrep ^python-singledispatch >/dev/null ; then
        opkg install --force-reinstall "${URL}/singledispatch-3.4.0.3-r0.ipk" > /dev/null 2>&1
    fi
    if ! opkg list-installed | egrep ^python-websocket-client >/dev/null ; then
        opkg install --force-reinstall "${URL}/python-websocket-client_0.57.0_all.ipk" > /dev/null 2>&1
    fi
    if ! opkg list-installed | egrep ^python-futures >/dev/null ; then
        opkg install --force-reinstall "${URL}/futures-2.1.6-r0__all.ipk" > /dev/null 2>&1
    fi
fi

echo ""
echo "    *** Streamlink[-27] INSTALLATION END ***"
reboot
